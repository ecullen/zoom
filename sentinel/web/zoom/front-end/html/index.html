<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="ZooKeeper Manager">
        <meta name="author" content="David Shrader">

        <title>Zoom</title>

        <link rel="stylesheet" type="text/css" href="front-end/styles/libs/bootstrap.css"/>
        <link rel="stylesheet" type="text/css" href="front-end/styles/app/spot.css"/>

        <script src="front-end/scripts/js/libs/require-2.1.14.min.js" data-main="main"></script>
        <script src="front-end/scripts/js/requireConfig.js"></script>
        <script src="front-end/scripts/js/libs/jquery-2.1.1.js"></script>
        <script type="text/javascript" src="front-end/scripts/js/libs/bootstrap.js"></script>
    </head>

    <body>
        <!-- Navigation Bar -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <a class="navbar-brand" href="#">Zoom</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav">
                <li class="active"><a href="index.html#/application_state">Application State</a></li>
                <li><a href="serverConfig.html">Server Config</a></li>
              </ul>
            </div>
          </div>
        </nav>

        <!-- viewModel (i.e. scripted below) will be inserted inside this knockout template -->
        <div data-bind="template: {name: view, data: viewModel, if: render}">
        </div>
    </body>

    <!-- Login Page -->
    <script type="text/html" id="login">
        <div id="login_page" class="container">
            <div class="mainbox col-md-4 col-md-offset-4 col-sm-8 col-sm-offset-2" style="margin-top:150px;">
                <div class="panel panel-info">
                    <div class="panel-heading">
                        <div class="panel-title">Sign In</div>
                    </div>
                    <div class="panel-body" style="padding-top:30px">
                        <div data-bind="visible: login.elements.showError" class="alert alert-danger col-sm-12">
                            <p id="error" data-bind="text: login.elements.error"><strong></strong></p>
                        </div>
                        <form role="form" class="form-horizontal">
                            <div class="input-group" style="margin-bottom: 25px">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                <input id="username"
                                       data-bind="value: login.elements.username"
                                       type="text"
                                       placeholder="username"
                                       class="form-control">
                            </div>
                            <div class="input-group" style="margin-bottom: 25px">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                <input id="password"
                                       data-bind="value: login.elements.password"
                                       type="password"
                                       placeholder="password"
                                       class="form-control">
                            </div>
                            <div class="form-group" style="margin-top:10px">
                                <div class="col-sm-12 controls">
                                    <button data-bind="click: submit"
                                            type="submit"
                                            class="btn btn-primary">
                                        <i class="icon-user icon-white"></i>
                                        Login
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <!-- END Login Page -->

    <!-- Application State Page -->
    <script type="text/html" id="application_state">
        <div id="application_state_page" class="container-fluid" style="margin-top: 20px">
            <div class="page-header">
                <h1>
                    Application State Agent 
                    <small>
                      <span data-bind="text: applicationState.applicationStates().length"></span> total services
                    </small>
                    <small class="pull-right">
                        Zookeeper global mode:
                        <div class="btn-group">
                            <button type="button" data-bind="click: function(){mode.fnSetGlobalMode('auto')}, attr: {class: mode.reactClass()}"
                                                  data-toggle="tooltip"
                                                  data-placement="top"
                                                  title="Set Zookeeper to react to state changes.">React</button>
                            <button type="button" data-bind="click: function(){mode.fnSetGlobalMode('manual')}, attr: {class: mode.ignoreClass()}"
                                                  data-toggle="tooltip"
                                                  data-placement="top"
                                                  title="Set Zookeeper to ignore state changes.">Ignore</button>
                        </div>
                    </small>
                </h1>

                <div class="row">
                    <div class="col-md-6 text-left">
                        <!-- Search Box -->
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search" data-bind="value: applicationState.textFilter, valueUpdate: 'afterkeydown'">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <span class="glyphicon glyphicon-search"></span>
                                </button>
                                <button class="btn btn-default" type="button" 
                                                                data-bind="click: applicationState.clearSearch"
                                                                data-toggle="tooltip"
                                                                data-placement="top"
                                                                title="Clear the search bar.">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </button>
                                <button class="btn btn-default dropdown-toggle" type="button" 
                                        data-toggle="dropdown"
                                        data-toggle="tooltip"
                                        data-placement="top"
                                        title="View filtering options.">
                                    Filters
                                    <span class="badge" data-bind="text: applicationState.customFilteredItems().length, 
                                                                   visible: applicationState.customFilteredItems().length > 0">
                                    </span>
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    <li role="presentation">
                                        <a data-bind="click: function(){applicationState.filterBy('tp')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Apply a filter to display tp services.">tp</a>
                                    </li>
                                    <li role="presentation">
                                        <a data-bind="click: function(){applicationState.filterBy('tms')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Apply a filter to display tms services.">tms</a>
                                    </li>
                                    <li role="presentation">
                                        <a data-bind="click: function(){applicationState.filterBy('mds')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Apply a filter to display mds services.">mds</a>
                                    </li>
                                    <li role="presentation">
                                        <a data-bind="click: function(){applicationState.filterBy('ceres')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Apply a filter to display ceres services.">ceres</a>
                                    </li>
                                    <li role="presentation" class="divider"></li>
                                    <li role="presentation">
                                        <a data-bind="click: applicationState.addCustomFilter"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Create a custom filter.">Custom Filter</a>
                                    </li>
                                    <li role="presentation" class="divider"></li>
                                    <li role="presentation">
                                        <a data-bind="click: applicationState.clearAllFilters"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Clear all filters.">Clear All</a>
                                    </li>
                                </ul>
                            </span>
                        </div>
                    </div>

                    <div class="col-md-6 text-right">
                        <!-- Group Control Menu -->
                        <div class="btn-group">
                            <button type="button" class="btn btn-default" 
                                                  data-bind="click: function(){applicationState.executeGroupControl('stop')}"
                                                  data-toggle="tooltip"
                                                  data-placement="top"
                                                  title="Stop the starred services.">Stop</button>
                            <button type="button" class="btn btn-default" 
                                                  data-bind="click: function(){applicationState.executeGroupControl('restart')}"
                                                  data-toggle="tooltip"
                                                  data-placement="top"
                                                  title="Restart the starred services.">Restart</button>
                            <button type="button" class="btn btn-default" 
                                                  data-bind="click: function(){applicationState.executeGroupControl('ignore')}"
                                                  data-toggle="tooltip"
                                                  data-placement="top"
                                                  title="Command the starred agents to ignore Zookeeper changes.">Ignore</button>
                            <button type="button" class="btn btn-default" 
                                                  data-bind="click: function(){applicationState.executeGroupControl('react')}"
                                                  data-toggle="tooltip"
                                                  data-placement="top"
                                                  title="Command the starred agents to react to Zookeeper changes.">React</button>
                            <button type="button" class="btn btn-default" 
                                                  data-bind="click: applicationState.filteredGroupControl()"
                                                  data-toggle="tooltip"
                                                  data-placement="top"
                                                  title="Star all of the filtered agents.">
                                <span class="glyphicon glyphicon-star"></span> all
                            </button>
                            <button class="btn btn-default" data-bind="click: applicationState.clearGroupControl"
                                                            data-toggle="tooltip"
                                                            data-placement="top"
                                                            title="Release all starred agents.">
                                <span class="badge" data-bind="text: applicationState.groupControl().length"></span>
                                <span class="glyphicon glyphicon-remove"></span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <!-- Custom Filters -->
                        <div data-bind="foreach: applicationState.customFilters">
                            <div class="row" style="margin-top: 5px">
                                <div class="col-md-12">
                                    <div class="btn-group" data-toggle="buttons">
                                        <label class="btn btn-default" 
                                               data-bind="click: function(){setParameter('applicationStatus')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Filter by Up/Down status.">
                                            <input type="radio">
                                            Up/Down
                                        </label>
                                        <label class="btn btn-default" 
                                               data-bind="click: function(){setParameter('configurationPath')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Filter by configuration path.">
                                            <input type="radio">
                                            Path
                                        </label>
                                        <label class="btn btn-default" 
                                               data-bind="click: function(){setParameter('applicationHost')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Filter by host.">
                                            <input type="radio">
                                            Host
                                        </label>
                                        <label class="btn btn-default" 
                                               data-bind="click: function(){setParameter('startTime')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Filter by start time.">
                                            <input type="radio">
                                            Start Time
                                        </label>
                                        <label class="btn btn-default" 
                                               data-bind="click: function(){setParameter('errorState')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Filter by error state.">
                                            <input type="radio">
                                            Status
                                        </label>
                                        <label class="btn btn-default" 
                                               data-bind="click: function(){setParameter('dependency')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Filter by dependent on.">
                                            <input type="radio">
                                            Dependency
                                        </label>
                                    </div>
                                    <span data-bind="template : {name: 'search-term-template'}"></span>
                                    <div class="btn-group" data-bind="visible: parameter() != '' && searchTerm() != ''">
                                        <button class="btn btn-default" 
                                                data-bind="click: toggleEnabled, visible: !enabled()"
                                                data-toggle="tooltip"
                                                data-placement="top"
                                                title="Enable the filter.">
                                            <span class="glyphicon glyphicon-off"></span>
                                        </button>
                                        <button class="btn btn-default active" 
                                                data-bind="click: toggleEnabled, visible: enabled()"
                                                data-toggle="tooltip"
                                                data-placement="top"
                                                title="Disable the filter.">
                                            <span class="glyphicon glyphicon-off"></span>
                                        </button>
                                        <button class="btn btn-default" 
                                                data-bind="click: toggleInversed, visible: !inversed()"
                                                data-toggle="tooltip"
                                                data-placement="top"
                                                title="Inverse the filter.">
                                            Inverse
                                        </button>
                                        <button class="btn btn-default active" 
                                                data-bind="click: toggleInversed, visible: inversed()"
                                                data-toggle="tooltip"
                                                data-placement="top"
                                                title="Un-inverse the filter.">
                                            Inverse
                                        </button>
                                    </div>
                                    <button class="btn btn-default" data-bind="click: deleteFilter"
                                            data-toggle="tooltip"
                                            data-placement="top"
                                            title="Delete the filter.">
                                        <span class="badge" data-bind="text: $data.customFilteredItems().length,
                                                                       visible: $data.customFilteredItems().length > 0"></span>
                                        <span class="glyphicon glyphicon-remove"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-body">
                <table class="table table-bordered table-condensed">
                    <!-- Headers -->
                    <thead>
                        <tr data-bind="foreach: applicationState.headers">
                            <th style="cursor:pointer"
                                data-toggle="tooltip"
                                data-placement="top"
                                title="Toggle ascending/descending sort based on this column.">
                                <span data-bind="visible: $parent.applicationState.activeSort().title == title">
                                    <span class="caret caret-reversed" data-bind="visible: asc"></span>
                                    <span class="caret" data-bind="visible: !asc()"></span>
                                </span>
                                <span data-bind="text: title, click: $parent.applicationState.sort"></span>
                                <span data-bind="visible: title == 'Configuration Path'">
                                    <small data-bind="click: $parent.applicationState.expandAllDependencies,
                                                      visible: !$parent.applicationState.showingAllDependencies()"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Toggle the display of all dependencies.">
                                        Expand All
                                    </small>
                                    <small data-bind="click: $parent.applicationState.collapseAllDependencies,
                                                      visible: $parent.applicationState.showingAllDependencies()"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Toggle the display of all dependencies.">
                                        Collapse All
                                    </small>
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <!-- Rows -->
                    <tbody data-bind="foreach: applicationState.filteredItems">
                        <tr>
                            <td data-bind="style : {backgroundColor : applicationStatusBg}" class="text-center">
                                <span data-bind="attr : {class : applicationStatusClass}"></span>
                            </td>
                            <td data-toggle="tooltip"
                                data-placement="top"
                                title="Toggle the display of dependencies.">
                                <span data-bind="text: configurationPath, click: toggleDependencies"></span>
                                <span data-bind="attr : {class : dependencyClass}"></span>
                                <span data-bind="visible: requires().length > 0 && showDependencies"><br>I require:</span>
                                <ul data-bind="foreach: requires, visible: showDependencies" style="list-style-type: none">
                                    <span data-bind="template: {name : 'dependencies-template'}"></span>
                                </ul>
                                <span data-bind="visible: requiredBy().length > 0 && showDependencies">I am required by:</span>
                                <ul data-bind="foreach: requiredBy, visible: showDependencies" style="list-style-type: none">
                                    <span data-bind="template: {name : 'dependencies-template'}"></span>
                                </ul>
                            </td>
                            <td data-bind="text: applicationHost"></td>
                            <td data-bind="text: startTime"></td>
                            <td data-bind="style : {backgroundColor : errorStateBg}" class="text-center">
                                <span data-bind="attr : {class : errorStateClass}"></span>
                            </td>
                            <td class="text-center">
                                <div class="btn-group">
                                    <button class="btn btn-default" 
                                            type="button" 
                                            data-bind="click: toggleGroupControl, html: groupControlStar"
                                            data-toggle="tooltip"
                                            data-placement="top"
                                            title="Star the agent to add it to group control.">
                                    </button>
                                    <button class="btn btn-default dropdown-toggle" type="button" 
                                            data-toggle="dropdown"
                                            data-toggle="tooltip"
                                            data-placement="top"
                                            title="View control options for the agent.">
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu pull-right" role="menu">
                                        <li role="presentation">
                                            <a data-bind="click: function(){controlAgent('stop')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Stop the agent.">Stop</a>
                                        </li>
                                        <li role="presentation">
                                            <a data-bind="click: function(){controlAgent('restart')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Restart the agent.">Restart</a>
                                        </li>
                                        <li role="presentation">
                                            <a data-bind="click: function(){controlAgent('ignore')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Command the agent to ignore Zookeeper changes.">Ignore</a>
                                        </li>
                                        <li role="presentation">
                                            <a data-bind="click: function(){controlAgent('react')}"
                                               data-toggle="tooltip"
                                               data-placement="top"
                                               title="Command the agent to react to Zookeeper changes.">React</a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </script>
    <!-- END Application State Page -->

    <!-- Templates for Custom Filters -->
    <script type="text/html" id="search-term-template">
        <!-- ko if: parameter() == "applicationStatus" -->
        <span data-bind="template: {name:'status-filter-template'}"></span>
        <!-- /ko -->

        <!-- ko if: parameter() == "errorState" -->
        <span data-bind="template: {name:'error-filter-template'}"></span>
        <!-- /ko -->

        <!-- ko if: parameter() == "applicationHost" -->
        <span data-bind="template: {name:'path-host-time-filter-template'}"></span>
        <!-- /ko -->

        <!-- ko if: parameter() == "startTime" -->
        <span data-bind="template: {name:'path-host-time-filter-template'}"></span>
        <!-- /ko -->

        <!-- ko if: parameter() == "configurationPath"-->
        <span data-bind="template: {name:'path-host-time-filter-template'}"></span>
        <!-- /ko -->

        <!-- ko if: parameter() == "dependency" || parameter() == "requires" || parameter() == "requiredBy"-->
        <span data-bind="template: {name:'dependency-filter-template'}"></span>
        <!-- /ko -->
    </script>

    <script type="text/html" id="status-filter-template">
        <div class="btn-group" data-toggle="buttons">
            <label class="btn btn-default" data-bind="click: function(){setSearchTerm('running')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Filter running services.">
                <input type="radio">
                <span class="glyphicon glyphicon-ok-circle"></span>
                </input>
            </label>
            <label class="btn btn-default" data-bind="click: function(){setSearchTerm('stopped')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Filter stopped services.">
                <input type="radio">
                <span class="glyphicon glyphicon-remove-circle"></span>
                </input>
            </label>
            <label class="btn btn-default" data-bind="click: function(){setSearchTerm('unknown')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Filter services whose up/down status is unknown.">
                <input type="radio">
                <span class="glyphicon glyphicon-question-sign"></span>
                </input>
            </label>
        </div>
    </script>

    <script type="text/html" id="error-filter-template">
        <div class="btn-group" data-toggle="buttons">
            <label class="btn btn-default" data-bind="click: function(){setSearchTerm('ok')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Filter services whose status is ok.">
                <input type="radio">
                <span class="glyphicon glyphicon-thumbs-up"></span>
                </input>
            </label>
            <label class="btn btn-default" data-bind="click: function(){setSearchTerm('starting')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Filter services whose status is starting.">
                <input type="radio">
                <span class="glyphicon glyphicon-retweet"></span>
                </input>
            </label>
            <label class="btn btn-default" data-bind="click: function(){setSearchTerm('stopping')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Filter services whose status is stopping.">
                <input type="radio">
                <span class="glyphicon glyphicon-arrow-down"></span>
                </input>
            </label>
            <label class="btn btn-default" data-bind="click: function(){setSearchTerm('error')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Filter services whose status is error.">
                <input type="radio">
                <span class="glyphicon glyphicon-warning-sign"></span>
                </input>
            </label>
            <label class="btn btn-default" data-bind="click: function(){setSearchTerm('unknown')}"
                                           data-toggle="tooltip"
                                           data-placement="top"
                                           title="Filter services whose status is unknown.">
                <input type="radio">
                <span class="glyphicon glyphicon-question-sign"></span>
                </input>
            </label>
        </div>
    </script>

    <script type="text/html" id="path-host-time-filter-template">
        <span class="form-inline">
            <input type="text" data-bind="value: searchTerm, valueUpdate: 'keyup'" class="form-control">
        </span>       
    </script>

    <script type="text/html" id="dependency-filter-template">
        <div class="btn-group" data-toggle="buttons">
            <label class="btn btn-default" 
                   data-bind="click: function(){setParameter('requires')}"
                   data-toggle="tooltip"
                   data-placement="top"
                   title="Filter by services that require the search term.">
                <input type="radio">
                Requires
            </label>
            <label class="btn btn-default" 
                   data-bind="click: function(){setParameter('requiredBy')}"
                   data-toggle="tooltip"
                   data-placement="top"
                   title="Filter by services required by the search term.">
                <input type="radio">
                Required By
            </label>
        </div>
        <span class="form-inline">
            <input type="text" data-bind="value: searchTerm, valueUpdate: 'keyup'" class="form-control">
        </span>
    </script>
    <!-- END Templates for Custom Filters -->

    <!-- Template for Displaying Dependencies -->
    <script type="text/html" id="dependencies-template">
        <li>
            <span data-bind="attr : {class : $data.applicationStatusClass}"></span>
            <span data-bind="text: $data.configurationPath"></span>
        </li>
    </script>

</html>