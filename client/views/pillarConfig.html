<section>
    <div id="loadVisual" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"> Refreshing pillars on salt master... </h4>
                    <i class="fa fa-refresh fa-spin"></i>
                </div>
            </div>
        </div>
    </div>
   <div id="validateVisual" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"> Validating changes on salt master... </h4>
                    <i class="fa fa-refresh fa-spin"></i>
                </div>
            </div>
        </div>
    </div>
    <div id="addModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title"> Create Mapping </h4>
                    <h4 class="modal-dialog"> Create a targetable mapping for a specific host.</h4>

                </div>
                <div class="modal-body">
                    <h4> Enter a unique hostname. Domain will be added to create the FQDN. </h4>
                    <div class="col-md-4">
                        <input type="text" class="form-control" placeholder="hostname" data-bind="textInput: pillarModel.newNodeName">
                    </div>
                    <span> .spottrading.com </span>
                    <button class="btn btn-default"
                            data-bind="click:  function() { pillarModel.saltModel.validate(pillarModel.newNodeName(), null, 'preCreate',
                            'node', null) }, visible: pillarModel.newNodeName()">Create
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="groupEditModal" class="modal fade">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Edit Multiple Servers</h3>
                </div>
                <div class="modal-body" data-bind="with: pillarModel">
                    <!-- Main div for each project!!! -->
                    <div id="eachProject" data-bind="foreach: allProjects()">

                        <h2 data-bind="text: $data.proj_name"></h2>
                        <div data-bind="visible: $data.editing">
                            <button type="button" class="btn btn-danger"
                                    data-bind="click: function () { $parent.updateProjectWrapper('delete', 'project', $data) },
                                     text: 'Delete Project ' + $data.proj_name" ></button>
                        </div>

                        <table class="table table-striped table-bordered" id="mainTable" style="margin-bottom: 20px; margin-top: 20px; cursor: pointer;"
                            data-bind="visible: !$data.editing(), click: function () {$parent.showEdit($data)}">
                            <caption> Click to edit </caption>
                            <thead>
                            <tr>
                                <th>Server</th>
                                <!-- ko foreach: $data.keys() -->
                                <th data-bind="text: $data"></th>
                                <!-- /ko -->
                            </tr>
                            </thead>

                            <tbody data-bind="foreach: $parent.checkedNodes()">
                            <tr>
                                <td data-bind="text: name"></td>
                                <!-- ko foreach: $parent.keys() -->
                                <td data-bind="text: $parents[2].getValues($parent, $parents[1], $data)"></td>
                                <!-- /ko -->
                            </tr>
                            </tbody>

                        </table>

                        <table class="table table-striped table-bordered edit" id="editTable"
                               data-bind="visible: $data.editing" style="margin-bottom: 20px; margin-top: 20px;">
                            <thead>
                            <tr>
                                <th>Server</th>
                                <!-- ko foreach: $data.edit_keys() -->
                                <th>
                                    <span data-bind="text: $data"></span>
                                    <button
                                            data-bind="click: function () { $parents[1].visualUpdate('delete', 'key', $parent,  $data) }">
                                        Delete
                                    </button>
                                </th>
                                <!-- /ko -->
                                <td>
                                    <div data-bind="visible: $data.editing">
                                        <input type="text" placeholder="New Key Name" data-bind="textInput: new_key">
                                        <button
                                                data-bind="click: function () { $parent.visualUpdate('create', 'key', $data) }">
                                            Add Key</button>
                                    </div>
                                </td>
                            </tr>
                            </thead>

                            <tbody data-bind="foreach: $parent.checkedNodes()">
                            <tr>
                                <td data-bind="text: name"></td>

                                <!-- ko foreach: $parent.edit_keys() -->
                                <td>
                                    <input data-bind="value: $parents[2].getValues($parent, $parents[1], $data), updateEdit: $parent.editable"
                                        style="width: 100%;">
                                </td>

<!--                                <td data-bind="visible: !$parent.editable(), text: $parents[2].getValues($parent, $parents[1], $data), click: function () { $parents[2].makeEditable($parent) }, updateLatest: $parent.editable"></td> -->
                                <!-- /ko -->
                            </tr>
                            </tbody>
                        </table>

                        <div class="container" data-bind="visible: $parent.selectedModify() == 'Existing project' && $data.editing">
                            <button data-bind="click: function() {$parent.updateProjectWrapper('update', 'wholeTable', $data)}">
                                Send updated table data
                            </button>
                            <button data-bind="click: function() { $parent.cancelEditing($data) }">Cancel Editing</button>
                        </div>
                    </div>
                    <!-- end of existing project tab-->
                </div>
            </div>
        </div>
    </div>

    <div data-bind="visible: pillarModel.login.elements.authenticated() == false">
        <h3 style="margin-top: 85px"> Please log-in to use the pillar editor </h3>
    </div>

    <div class="container-fluid" data-bind="with: pillarModel, visible: pillarModel.login.elements.authenticated() == true">
        <div class="page-header" style="margin-top: 85px">
            <h1> Pillar Value Editor<small> v0.3 </small></h1>

            <div class="row view-tabs">
                <div class="col-md-6 text-left">
                    <button class="btn btn-default" data-bind="click: function() { showModal('addModal') }" type="button" title="Add Host to Map project to">
                        <span class="glyphicon glyphicon-plus"></span>
                        Add Server for Mapping
                    </button>
                </div>
                <div class="col-md-6 text-right">
                    <small class="pull-right">
                        <div class="pull-right">
                             <button class="btn btn-default" data-bind="click: function() { showModal('groupEditModal') }" data-placement="top" type="button" title="Group Edit Server Data">
                                <span class="glyphicon glyphicon-edit"></span>
                                Group Edit
                             </button>
                        </div>
                    </small>
                </div>
            </div>


        </div>


        <div class="page-body">
            <!--sidebar-->
            <div id="searchPane" class="col-md-4 hidden-desktop" data-bind="visible: selectedOption() != 'Create Pillar'">
                
                <div class="input-group" style="margin-bottom: 20px;">
                    <input type="text"  id="searchBox" class="form-control" data-bind="value: searchVal, text: searchVal,
                     valueUpdate:'afterkeydown'" placeholder="Server or project name..." autofocus="">
                    <span class="input-group-btn">
                        <button class="btn btn-default" data-bind="click: function() {removeQuery()}" type="button"
                                title="Clear search">
                            <span class="glyphicon glyphicon-remove"></span>
                            Clear Query
                        </button>
                        <button class="btn btn-default" data-bind="click: function() {checkAll()}" type="button"
                                title="Select all visible servers, with a maximum of 8 at a time">
                            <span class="glyphicon glyphicon-check"></span>
                            Check All
                        </button>
                        <button class="btn btn-default" data-bind="click: function() {uncheckAll()}" type="button"
                                title="Unselect ALL selected servers, not just visible ones">
                            <span class="glyphicon glyphicon-unchecked"></span>
                            <span class="badge" data-bind="text: checkedNodes.length"></span>
                            Uncheck All
                        </button>

                    </span>
                </div>

            </div>

            <div class="checkbox-list">
                <table class="table table-bordered table-condensed">
                    <thead>
                        <tr>
                            <th>
                                Host Name
                            </th>
                            <th>
                                Projects/Services/Applications
                            </th>
                            <th>
                                Select
                            </th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach: queriedNodes">
                        <tr>
                            <td data-bind="text: name"></td>
                            <td data-bind="text: $parent.getArray($data)"></td>
                            <td>
                                <button class="btn btn-default" type="button" data-bind="click: function() { $parent.handleSelect($data) }">
                                    <span data-bind="attr: { class: star }"></span>
                                </button>
                            </td>
                            <!--
                            <span data-bind="template: {name: 'individual-host-template'}"></span>
                            -->

                        </tr>
                    </tbody>
                </table>
            </div>
        
            <div id="mainPane" class="col-md-8"> 
                <div data-bind="visible: checkedNodes().length > 0 && selectedOption() == 'Delete Pillar(s)'">
                    <span> Selected servers: </span>
                    <div data-bind="foreach: checkedNodes">
                        <table>
                            <tr data-bind="text: name"></tr>
                        </table>
                    </div>
                    <button type="button" class="btn btn-danger"
                            data-bind="click: function() { pillarApiModel.delPillar() }">Delete</button>
                </div>

                <div data-bind="visible: checkedNodes().length == 0 && selectedOption() != 'Create Pillar'">
                    <h4>
                        Please select at least one server. 
                    </h4>
                </div>



                <div data-bind="visible: checkedNodes().length > 0">

                    <div class="btn-group" data-bind="foreach: modifyOptions">
                        <button class="btn btn-default" data-bind="radio: $parent.selectedModify">
                            <span data-bind="text: $data"></span>
                        </button>
                    </div>

                    <div class="row" data-bind="visible: selectedModify() == 'Existing project'">
                        <div class="col-md-4 text-left">
                            <div data-bind="visible: allProjects().length == 0"> 
                                <h4> No projects exist on the selected server(s)</h4>
                            </div>
                    
                        </div>
                    </div>

                    <!-- Main div for each project!!! -->
                    <div id="eachProject" data-bind="foreach: allProjects()">

                        <h2 data-bind="text: $data.proj_name"></h2>
                        <div data-bind="visible: $data.editing">
                            <button type="button" class="btn btn-danger"
                                    data-bind="click: function () { $parent.updateProjectWrapper('delete', 'project', $data) },
                                     text: 'Delete Project ' + $data.proj_name" ></button>
                        </div>

                        <table class="table table-striped table-bordered" id="mainTable" style="margin-bottom: 20px; margin-top: 20px; cursor: pointer;"
                            data-bind="visible: !$data.editing(), click: function () {$parent.showEdit($data)}">
                            <caption> Click to edit </caption>
                            <thead>
                            <tr>
                                <th>Server</th>
                                <!-- ko foreach: $data.keys() -->
                                <th data-bind="text: $data"></th>
                                <!-- /ko -->
                            </tr>
                            </thead>

                            <tbody data-bind="foreach: $parent.checkedNodes()">
                            <tr> 
                                <td data-bind="text: name"></td>
                                <!-- ko foreach: $parent.keys() -->
                                <td data-bind="text: $parents[2].getValues($parent, $parents[1], $data)"></td>
                                <!-- /ko -->
                            </tr>
                            </tbody>

                        </table>

                        <table class="table table-striped table-bordered edit" id="editTable"
                               data-bind="visible: $data.editing" style="margin-bottom: 20px; margin-top: 20px;">
                            <thead>
                            <tr>
                                <th>Server</th>
                                <!-- ko foreach: $data.edit_keys() -->
                                <th>
                                    <span data-bind="text: $data"></span>
                                    <button
                                            data-bind="click: function () { $parents[1].visualUpdate('delete', 'key', $parent,  $data) }">
                                        Delete
                                    </button>
                                </th>
                                <!-- /ko -->
                                <td>
                                    <div data-bind="visible: $data.editing">
                                        <input type="text" placeholder="New Key Name" data-bind="textInput: new_key">
                                        <button
                                                data-bind="click: function () { $parent.visualUpdate('create', 'key', $data) }">
                                            Add Key</button>
                                    </div>
                                </td>
                            </tr>
                            </thead>

                            <tbody data-bind="foreach: $parent.checkedNodes()">
                            <tr> 
                                <td data-bind="text: name"></td>

                                <!-- ko foreach: $parent.edit_keys() -->
                                <td>
                                    <input data-bind="value: $parents[2].getValues($parent, $parents[1], $data), updateEdit: $parent.editable"
                                        style="width: 100%;">
                                </td>

<!--                                <td data-bind="visible: !$parent.editable(), text: $parents[2].getValues($parent, $parents[1], $data), click: function () { $parents[2].makeEditable($parent) }, updateLatest: $parent.editable"></td> -->
                                <!-- /ko -->
                            </tr>
                            </tbody>
                        </table>

                        <div class="container" data-bind="visible: $parent.selectedModify() == 'Existing project' && $data.editing">
                            <button data-bind="click: function() {$parent.updateProjectWrapper('update', 'wholeTable', $data)}">
                                Send updated table data
                            </button>
                            <button data-bind="click: function() { $parent.cancelEditing($data) }">Cancel Editing</button>
                        </div>
                    </div>
                    <!-- end of existing project tab-->

                    <div data-bind="visible: selectedModify() == 'New project'">
                        <h3>Create project <small> For ALL selected servers. Blank values will be null </small> </h3>
                        <span> Project name: </span>
                        <input type="text" placeholder="Project Name" data-bind="textInput: new_project">
                        <!-- ko foreach: new_pairs() -->
                        <div class="row">
                            <input type="text" placeholder="Key" data-bind="textInput: key">
                            <input type="text" placeholder="JSON-formatted Value" data-bind="textInput: value">
                        </div>
                        <!-- /ko-->
                        <button class="btn btn-default" data-bind="click: function() {addPair()}">Add another key-value pair</button>
                        <button class="btn btn-default" data-bind="click: function() {removePair()}">Remove a key-value pair</button>
                        <button class="btn btn-default" data-bind="click: function() {createProjectWrapper(new_project())}">Create</button>
                    </div>

                </div>
            </div>
        <!-- end main pane-->
        </div>
  
    </div>
</section>
