<section>
    <div class="container" data-bind="with: pillarModel">
        <div class="page-header" style="margin-top: 85px">
            <h1> Pillar Value Editor </h1>
            <div class="btn-group" data-bind="foreach: pillarOptions">
                <button class="btn btn-default" data-bind="radio: $parent.selectedOption">
                    <span data-bind="text: $data"></span>
                </button>
            </div>
            <button class="btn btn-default" data-bind="click: function() { toggleSearch()}">
                <span class="glyphicon glyphicon-align-justify"></span> 
            </button>

        </div>

        <div class="row">
            <!--sidebar-->
            <div id="searchPane" class="col-md-4 hidden-desktop" data-bind="visible: selectedOption() != 'Create Pillar'">
                
                <div class="input-group">
                    <input type="text" id="searchBox" class="form-control" data-bind="value: searchVal, text: searchVal, valueUpdate:'afterkeydown'" placeholder="Server name..." autofocus=""></input> 
                    <span class="input-group-btn">
                        <button class="btn btn-default" data-bind="click: function() {removeQuery()}" type="button" title="Clear search">
                            <span class="glyphicon glyphicon-remove"></span>
                        </button>
                        <button class="btn btn-default" data-bind="click: function() {checkAll()}" type="button" title="Select all visible servers, with a maximum of 8 at a time">
                            <span class="glyphicon glyphicon-check"></span>
                        </button>
                        <button class="btn btn-default" data-bind="click: function() {uncheckAll()}" type="button" title="Unselect ALL selected servers, not just visible ones">
                            <span class="glyphicon glyphicon-unchecked"></span>
                        </button>

                    </span>
                </div>

                <div class="checkbox-list">
                    <div data-bind="foreach: show_allInfo"> 
                        <div> 
                            <input type="checkbox" data-bind="value: name, checked: checked">
                            <span data-bind="text: name"></span>
                            <!--<span data-bind="text: ko.toJSON(pillar, null, 2)"></span>-->
                        </div>
                    </div>
                </div>
            </div>
        
            <div id="mainPane" class="col-md-6"> 
                <div data-bind="visible: checked_servers().length > 0 && selectedOption() == 'Delete Pillar(s)'">
                    <span> Selected servers: </span>
                    <div data-bind="foreach: checked_servers">
                        <table>
                            <td data-bind="text: name"></td>
                        </table>
                    </div>
                    <button type="button" class="btn btn-danger" data-bind="click: function() { api_delete('pillar') }">Delete</button>
                </div>

                <div data-bind="visible: checked_servers().length == 0 && selectedOption() != 'Create Pillar'">
                    <h4>
                        Please select at least one server. 
                    </h4>
                </div>

                
                <div data-bind="visible: selectedOption() == 'Create Pillar'">
                    <h4> Enter a unique hostname. Domain will be added to create the FQDN. </h4>
                    <div class="col-md-4">
                        <input type="text" class="form-control" placeholder="hostname" data-bind="textInput: fieldOneVal"></input> 
                    </div>
                    <span> .spottrading.com </span>
                    <button data-bind="click:  function() { api_post('pillar', fieldOneVal())}, visible: fieldOneVal()">Create</button>
                </div>

                <div data-bind="visible: checked_servers().length > 0 && selectedOption() == 'Modify Pillar(s)'">

                    <div class="btn-group" data-bind="foreach: modifyOptions">
                        <button class="btn btn-default" data-bind="radio: $parent.selectedModify">
                            <span data-bind="text: $data"></span>
                        </button>
                    </div>

                    <h3 data-bind="visible: selectedProject(), text: 'Update ' + selectedProject() + ' for all selected servers'"></h3>

                    <table>
                        <caption data-bind="visible: selectedProject(), text: selectedProject()"></caption>
                        <thead>
                        <tr>
                            <td>Server</td>
                            <!-- ko foreach: allKeys() -->
                            <td data-bind="text: $data"></td>
                            <!-- /ko -->
                        </tr>
                        </thead>

                        <tbody data-bind="foreach: checked_servers()">
                        <tr> 
                            <td data-bind="text: name"></td>
                            <!-- ko foreach: $parent.allKeys() -->
                            <td data-bind="text: $parents[1].subtype_get($parent, $data)"></td>
                            <!-- /ko -->
                            <!-- Direct access, but can't handle errors if data not there -->
                            <!-- <td data-bind="text: $data[$parent.selectedProject()]().version"></td>-->
                        </tr>
                        </tbody>

                    </table>

                    <div class="container" data-bind="visible: selectedModify() == 'Existing project'">
                        <div class="row">
                            <div class="col-md-2 dropdown text-left">
                                <button class="btn btn-default dropdown-toggle" type="button" id="allProjDropdown" data-toggle="dropdown" aria-expanded="true"> 
                                Select a project
                                <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="allProjDropdown" data-bind="foreach: allProjects()">
                                    <li role="presentation" id="allDrop"><a role="menuitem" tabindex="-1" data-bind="text: $data"></a></li>
                                </ul>
                            </div>
                            <div class="col-md-2 text-right">
                                <button type="button" class="btn btn-danger" data-bind="click: function () { api_delete('project') }, text: 'Delete '+selectedProject() + ' from selected servers', visible: selectedProject()"></button>
                            </div>
                        </div>



                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle" type="button" id="allKeyDropdown" data-toggle="dropdown">
                                Select a key
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="allKeyDropdown" data-bind="foreach: allKeys()">
                                <li role="presentation" id="allKey"><a role="menuitem" tabindex="-1" data-bind="text: $data"></a></li>
                            </ul>
                        </div>


                        <div class="row" data-bind="visible: selectedKey()">
                            <span data-bind="text: selectedKey"></span>
                            <input data-bind="textInput: edit_value"></input>
                            <button data-bind="click: function() {api_put(selectedKey(), edit_value())}">Push update</button>
                            <button class="btn btn-danger" data-bind="click: function() {api_delete('key')}">Delete Key</button>
                        </div>

                        <div class="row" data-bind="visible: selectedProject()">
                            <h4 data-bind="text: 'New key-value pair for ' + selectedProject()"></h4>
                            <input data-bind="textInput: new_key"></input>
                            <input data-bind="textInput: new_value"></input>
                            <button data-bind="click: function() {newPairWrapper($data)}"> Push new pair </button>
                        </div>

                    </div>

                    <div data-bind="visible: selectedModify() == 'New project'">
                        <h3>Create project <small> Blank values will be null </small> <h3/>
                        <span> Project name: </span>
                        <input data-bind="textInput: new_project"></input>
                        <!-- ko foreach: new_pairs() -->
                        <div class="row">
                            <input data-bind="textInput: key"></input>
                            <input data-bind="textInput: value"></input>
                        </div>
                        <!-- /ko-->
                        <button data-bind="click: function() {addPair()}">Add new key-value pair</button>
                        <button data-bind="click: createProjectWrapper(new_project())">Create</button>
                    </div>

                </div>

                <div data-bind="visible: selectedOption() == 'View Pillar(s)', foreach: checked_servers()" id="showJSON">
                    <p data-bind="text: name"></p>
                    <textarea style="width: 500px; height: 500px" data-bind="value: ko.toJSON(pillar, null, 2)"></textarea>
                </div>
            </div>
        <!-- end main pane-->
        </div>
  
    </div>
</section>
